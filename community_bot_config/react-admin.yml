templates:
    verified_safety_number_message:
        type: m.room.message
        variables:
            event_id: '{{event.event_id}}'
        content:
            msgtype: m.text
            body: |
                Good to go. Thanks for confirming you are still you. This small step is how we keep the irregularchat safe.

                1. Please leave this chat
                See you out there!
            m.relates_to:
                m.in_reply_to:
                    event_id: '{{event_id}}'

    safety_number_check:
        type: m.room.message
        variables:
            event_id: '{{event.event_id}}'
        content:
            msgtype: m.text
            body: |
                It shows that your safety number has changed. For the privacy and security of all, we ask that you provide one of the following:
                - Your details: Name, organization, and who added you
                - Your IrregularChat Element Messenger username or email that we can verify

                If you don't reply to this message in 24 hours, your account will be removed from the chats, and you can request to join again when you are ready.

                @mods verify username or email: https://mod.irregular.chat
                @mods use: !remindme 24 hours Remove user if no response
            m.relates_to:
                m.in_reply_to:
                    event_id: '{{event_id}}'

    request_join:
        type: m.room.message
        variables:
            event_id: '{{event.event_id}}'
        content:
            msgtype: m.text
            body: |
                You've requested to join the IrregularChat Community. 

                Bonafides: Everyone in the chat has been invited by another who they personally know. So that we can add you to the right groups, we need to know:
                1. Who you are
                2. What org are you with
                3. Who invited you (Add this and mention them in this chat)
                4. Interests (So we can get you to the right chats)

                When you have been verified you can leave this chat.

                @mods use: 
                !remindme 24 hours Remove user if no response
            m.relates_to:
                m.in_reply_to:
                    event_id: '{{event_id}}'

    verified_request_message:
        type: m.room.message
        variables:
            event_id: '{{event.event_id}}'
        content:
            msgtype: m.text
            body: |
                Good to go. Thanks for verifying. This is how we keep the community safe.
                1. Please leave this chat
                2. You'll receive a direct message with your IrregularChat Login and a Link to all the chats.
                3. Join all the Chats that interest you when you get your login
                4. Until then, Learn about the community https://irregularpedia.org/index.php/Main_Page

                See you out there!
            m.relates_to:
                m.in_reply_to:
                    event_id: '{{event_id}}'

    help_menu: 
        type: m.room.message
        variables:
            event_id: '{{event.event_id}}'
        content:
            msgtype: m.text
            body: |
                IrregularChat Bot Admin Commands:
                - !safetynumber or !sn : To prompt a user to verify their safety number.
                - !request : To prompt a user to provide information to join the community.
                - !gtg or !verified : After a user has verified their safety number, provide the next steps.
                - !sngtg : After a user has verified their safety number, provide the next steps.
                - !invite : To provide instructions on how to invite someone to the community.
                - !topics : To provide instructions on how to join other chats.
                - !help : To display this menu.
            m.relates_to:
                m.in_reply_to:
                    event_id: '{{event_id}}'
    invite_instructions:
        type: m.room.message
        variables:
            event_id: '{{event.event_id}}'
        content:
            msgtype: m.text
            body: |
                To invite someone to the IrregularChat Community:
                1. Make sure you let them know about the community that they are joining, you are vouching for them. 
                
                2. Login to the Forum and follow the instructions here: https://forum.irregularchat.com/t/community-links-to-chats-and-services/229#p-598-inviting-others-to-the-irregularchat-community-4

                If you don't have a login on sso.irregularchat.com you'll need to message an admin to get one.
            m.relates_to:
                m.in_reply_to:
                    event_id: '{{event_id}}'
    join_other_chats_instructions:
        type: m.room.message
        variables:
            event_id: '{{event.event_id}}'
        content:
            msgtype: m.text
            body: |
                To see all the other chat topics and join them:
                Login to the Forum and see the direct links to join any of the many focused chats: https://forum.irregularchat.com/t/community-links-to-chats-and-services/229
            m.relates_to:
                m.in_reply_to:
                    event_id: '{{event_id}}'

default_flags:
- ignorecase
antispam:
    room:
        max: 25
        delay: 60
    user:
        max: 9
        delay: 60

rules:
    safetynumber:
        rooms:
        - '!YZQZfJnemJSYkxcYbA:irregularchat.com'
        - '!EzjSxyqeDljGcDDcFQ:irregularchat.com'
        matches:
        - ^!safetynumber\b
        - ^!sn\b
        template: safety_number_check

    request:
        rooms:
        - '!YZQZfJnemJSYkxcYbA:irregularchat.com'
        - '!EzjSxyqeDljGcDDcFQ:irregularchat.com'
        matches:
        - ^!request\b
        template: request_join

    verified_trigger:
        rooms:
        - '!YZQZfJnemJSYkxcYbA:irregularchat.com'
        - '!EzjSxyqeDljGcDDcFQ:irregularchat.com'
        matches:
        - ^!gtg\b
        - ^!verified\b
        template: verified_request_message

    safetynumber_verified_trigger:
        rooms:
        - '!YZQZfJnemJSYkxcYbA:irregularchat.com'
        - '!EzjSxyqeDljGcDDcFQ:irregularchat.com'
        matches:
        - ^!sngtg\b
        template: verified_safety_number_message
    
    help_prompt:
        rooms:
        - '!YZQZfJnemJSYkxcYbA:irregularchat.com'
        - '!EzjSxyqeDljGcDDcFQ:irregularchat.com'
        matches:
        - ^!help\b
        template: help_menu
    
    invite_instructions_prompt:
        matches:
        - ^!invite\b
        - \bhow to invite\b
        - \binvite others\b
        template: invite_instructions

    join_other_chats_instructions_prompt:
        matches:
        - ^!topics\b
        template: join_other_chats_instructions